arazzo: 1.0.0
info:
  title: A pet purchasing workflow
  summary: This Arazzo Description showcases the workflow for how to purchase a pet through a sequence of API calls
  description: |
    This Arazzo Description walks you through the workflow and steps of `searching` for, `selecting`, and `purchasing` an available pet.
  version: 1.0.1
sourceDescriptions:
  - name: petstoreDescription
    url: https://raw.githubusercontent.com/swagger-api/swagger-petstore/master/src/main/resources/openapi.yaml
    type: openapi

workflows:
  - workflowId: login
    summary: Login User
    description: This workflow lays out the steps to login a user and then retrieve pets
    inputs:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    steps:
      - stepId: loginStep
        description: This step demonstrates the user login step
        operationId: loginUser
        parameters:
          # parameters to inject into the loginUser operation (parameter name must be resolvable at the referenced operation and the value is determined using {expression} syntax)
          - name: username
            in: query
            value: $inputs.username
          - name: password
            in: query
            value: $inputs.password
        successCriteria:
          # assertions to determine step was successful
          - condition: $statusCode == 200
        outputs:
          # outputs from this step
          tokenExpires: $response.header.X-Expires-After
          rateLimit: $response.header.X-Rate-Limit
          sessionToken: $response.body
  - workflowId: loginUserAndOrderToy
    summary: Login User and then order a toy
    inputs:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    dependsOn:
      - login
    steps:
      - stepId: listPets
        description: retrieve a pet by status from the GET pets endpoint
        operationPath: '{$sourceDescriptions.petstoreDescription.url}#/paths/~1store~1order/post'
        parameters:
          - name: Authorization
            in: header
            value: $steps.loginUser.outputs.sessionToken
        successCriteria:
          - condition: $statusCode == 201
        outputs:
          availablePets: $response.body
    outputs:
      available: $steps.getPetStep.availablePets

  - workflowId: loginUserAndRetrievePets
    summary: Login User and then retrieve pets
    dependsOn:
      - login
    description: This workflow lays out the steps to login a user and then retrieve pets
    inputs:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    steps:
      - stepId: getPetStep
        description: retrieve a pet by status from the GET pets endpoint
        operationPath: '{$sourceDescriptions.petstoreDescription.url}#/paths/~1pet~1findByStatus/get'
        parameters:
          - name: status
            in: query
            value: 'available'
          - name: Authorization
            in: header
            value: $steps.loginUser.outputs.sessionToken
        successCriteria:
          - condition: $statusCode == 200
        onSuccess:
          - name: dogOrCat
            type: goto
            workflowId: loginUserAndOrderToy
            criteria:
              - type: regex
                context: $response.body.kind
                condition: '^(dog|cat)$'
              - type: regex
                context: $response.body.name
                condition: '^[a-c]'
        outputs:
          # outputs from this step
          availablePets: $response.body
    outputs:
      available: $steps.getPetStep.availablePets